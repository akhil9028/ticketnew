<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bus Ticket</title>
    <link rel="stylesheet" href="passTicket.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Ubuntu:wght@300&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/cf268fac04.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
  </head>
  <body>
    <div class="navbar">
      <img src="images/logo4.png" alt="sbdhm" />
      <a href="#" onclick="toggleDropdown()"
        ><i class="fa-solid fa-bars fa-2xl"></i
      ></a>
      <div id="dropdown" class="dropdown-content">
        <a href="index.html">Home</a>
        <a href="about_us.html">About Us</a>
        <a href="#">Helpline</a>
      </div>
    </div>

    <div class="tic-flex">
      <div class="ticket" id="invoice">
        <img src="images/logo4.png" alt="logo" width="100 px" height="100px" />
        <div class="ticket-header">
          <h2>Bus Ticket</h2>
        </div>
        <div class="ticket-info">
          <p>Bus Number:<span id="bus-id1">XYZ123</span></p>
          <p>Date: <span id="date">March 5, 2024</span></p>
          <p>Time: <span id="time">10:00 AM</span></p>
          <p>Price: <span id="passPrice1">$10.00</span><b>rs</b></p>
          <p>Tickets: <span id="tkt">1</span></p>
          <p>Start Point: <span id="src">City A</span></p>
          <p>End Point: <span id="dest">City B</span></p>
        </div>
        <div class="ticket-valid">
          <p>Valid Till: <span id="valTime">12:00 AM</span></p>
        </div>
        <div>
          <img
            id="myqr"
            class="qr qr-codes"
            src="images/newqr.png"
            alt="QR Code"
            height="100px"
            width="100px"
          />
        </div>
        <div class="helpline">
          <p><span>Helpline Number:</span> 123-456-7890</p>
        </div>
      </div>
      <button id="downloadBtn">Download Ticket</button>
    </div>

    <script>
      const urlParams = new URLSearchParams(window.location.search);

      var fare = urlParams.get("fare");
      let tickets = urlParams.get("pass");
      let id = urlParams.get("id");

      var qr = document.getElementById("myqr");

      var qrImg = document.querySelector(".qr-codes");

      var sum = fare + tickets + id;

      url = "akhil9028.github.io/VerifyTicket/?totalFare=" + sum;

      qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${url}`;
      function generatePDF() {
        document.getElementById("downloadBtn").addEventListener("click", () => {
          const invoice = this.document.getElementById("invoice");
          qr.src = "images/newqr.png";

          html2pdf().from(invoice).save();
        });
      }
      generatePDF();

      document.addEventListener("DOMContentLoaded", () => {
        let bus22 = document.getElementById("bus-id");

        var ticcc = getURLParameter("pass");
        var iidd = getURLParameter("id");
        var prr = getURLParameter("fare");
        var from = getURLParameter("from");
        var to = getURLParameter("to");

        fetch("/normalTicket", {
          // iddo: bus22.textContent,
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            ticc: ticcc,
            iiddd: iidd,
            prrr: prr,
            start: from,
            end: to,
            // ... other required parameters
          }),
        });
      });
    </script>

    <script src="script.js"></script>
  </body>
</html>
